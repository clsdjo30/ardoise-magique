{% extends '@EasyAdmin/page/content.html.twig' %}

{% block page_title %}
	<span class="mb-5">
		<i class="fa fa-fire"></i>
		Mode StreetFood actif
	</span>
{% endblock %}

{% block main %}
	{% set publishedMenu = publishedMenu ?? null %}
	{% if publishedMenu %}
		{% set publishedUrl = url('app_show_menu', {
            restaurant: publishedMenu.owner.slug,
            slug: publishedMenu.slug
        }) %}
	{% endif %}

	<div class="container-fluid my-5">
		<header class="row align-items-center justify-content-around mb-4">
			<div class="card col-6">
				<div class="">
					<i class="fa fa-truck-fast"></i>
					Ligne de feu pour les chefs
				</div>
				<h1 class="">Ardoise & Menus en mode street</h1>
				<p class="">
					Tableaux prÃªts a partager, liens publics immediats et actions rapides pour garder votre carte a jour sans effort.
				</p>
				<div class="">
					<span class="">
						<i class="fa fa-location-dot"></i>
						{{ app.user.nomRestaurant }}</span>
					<span class="">
						<i class="fa fa-link"></i>
						/m/{{ app.user.slug }}/[slug-menu]</span>
					<span class="">
						<i class="fa fa-bullhorn"></i>
						{{ menusPublies }}
						publie{{ menusPublies > 1 ? 's' : '' }}</span>
				</div>
				<div class="">
					<a class="btn btn-primary" href="{{ ea_url().setController('App\\Controller\\Admin\\DailyMenuCrudController').setAction('new') }}">
						<i class="fa fa-plus"></i>
						Menu du jour
					</a>
					<a class="btn btn-secondary" href="{{ ea_url().setController('App\\Controller\\Admin\\SpecialMenuCrudController').setAction('new') }}">
						<i class="fa fa-star"></i>
						Menu special
					</a>
					<a class="btn btn-ghost" href="#menus-list">
						<i class="fa fa-list"></i>
						Voir mes menus
					</a>
				</div>
			</div>
			<div class="card col-4">
				<div class="">
					<span>Lien public actif</span>
					<span class=" {{ publishedMenu ? 'success' : 'draft' }}">
						<i class="fa {{ publishedMenu ? 'fa-check' : 'fa-eye-slash' }}"></i>
						{{ publishedMenu ? 'Publie' : 'En attente' }}
					</span>
				</div>
				{% if publishedMenu %}
					<div class=" mb-2">
						<div class=" mb-2">Menu :
							{{ publishedMenu.titre }}</div>
						<div class="input-group input-group-sm">
							<input type="text" class="form-control" id="published-url" value="{{ publishedUrl }}" readonly>
							<button class="btn btn-outline-primary" type="button" onclick="copyToClipboard('published-url')" title="Copier le lien">
								<i class="fa fa-copy"></i>
							</button>
							<a class="btn btn-outline-success" href="{{ publishedUrl }}" target="_blank" title="Voir le menu">
								<i class="fa fa-external-link-alt"></i>
							</a>
						</div>
					</div>
					<div class="">
						<span class="btn">
							<i class="fa fa-qrcode"></i>
							Imprimez ou collez ce lien dans un QR code pour vos tables.
						</span>
						<span class="btn">
							<i class="fa fa-bolt"></i>
							Republiez apres chaque service pour rester en tete des feeds.
						</span>
					</div>
				{% else %}
					<div class="">
						<p class="mb-2">Aucun menu publie pour l'instant.</p>
						<p class=" mb-0">Publiez un menu pour activer un lien public partageable.</p>
					</div>
				{% endif %}
			</div>
		</header>

		<section class="container-fluid">
			<div class="row align-items-center justify-content-around g-5">
				<div class="col-3 card">
					<span class="fs-5">Total menus</span>
					<span class="fs-1">{{ totalMenus }}</span>
					<span class="fs-5">
						<i class="fa fa-fire"></i>
						Ardoises pretes</span>
				</div>
				<div class="col-3 card">
					<span class="fs-5">Publies</span>
					<span class="fs-1">{{ menusPublies }}</span>
					<span class="fs-5 text-success">
						<i class="fa fa-check"></i>
						Visible par vos clients</span>
				</div>
				<div class="col-3 card">
					<span class="fs-5">Brouillons</span>
					<span class="fs-1">{{ totalMenus - menusPublies }}</span>
					<span class="fs-5 text-warning">
						<i class="fa fa-hourglass-half"></i>
						En cuisine</span>
				</div>
			</div>
		</section>

		<section class="container-fluid mt-4">
			<div class="row row-cols-3  justify-content-evenly gx-5">
				<div class="card col-4">
					<h4>
						<i class="fa fa-wand-magic-sparkles pe-1"></i>
						Raccourcis de service</h4>
					<p class="mb-4 fs-6">Creer, dupliquer ou ajuster vos ardoises en quelques secondes.</p>
					<div class="cta-row">
						<a class="btn btn-secondary  px-2" href="{{ ea_url().setController('App\\Controller\\Admin\\DailyMenuCrudController').setAction('new') }}">
							<i class="fa fa-plus"></i>
							Nouveau menu du jour
						</a>
						<a class="btn btn-cta-danger px-2" href="{{ ea_url().setController('App\\Controller\\Admin\\SpecialMenuCrudController').setAction('new') }}">
							<i class="fa fa-star"></i>
							Nouveau special
						</a>
					</div>
				</div>
                <div class="card col-3">
					<h4>
						<i class="fa fa-lightbulb pe-1"></i>
						Plan de tir</h4>
					<ul class="steps ps-3 mb-0 ">
						<li>Nommer le menu (date ou evenement) de facon claire.</li>
						<li>Renseigner prix et items, puis cocher "Publie".</li>
						<li>Copier le lien public et coller en story ou QR code.</li>
						<li>Mettre a jour chaque jour pour booster la fidelite.</li>
					</ul>
				</div>
				<div class="card col-4">
					<h4>
						<i class="fa fa-bullhorn pe-1"></i>
						Partage express</h4>
					<p class="mb-3 fs-6">Diffusez votre carte sur vos canaux en un clic. Copiez le lien et balancez-le dans vos stories.</p>
					<div class="cta-row">
						<button class="btn btn-outline-primary btn-lg px-3" type="button" onclick="copyFirstPublicUrl()" {% if not publishedMenu %} disabled {% endif %}>
							<i class="fa fa-copy"></i>
							Copier le lien actif
						</button>
						{% if publishedMenu %}
							<a class="btn btn-outline-success btn-lg px-3" href="{{ publishedUrl }}" target="_blank">
								<i class="fa fa-external-link-alt"></i>
								Voir le rendu client
							</a>
						{% endif %}
					</div>
					<small class="label-muted d-block mt-3">Astuce : ajoutez le lien dans la bio Instagram ou Google Business.</small>
				</div>
			</div>
		</section>

		<div class="card" >
			<div class="card-header d-flex justify-content-between align-items-center">
				<span>
					<i class="fa fa-clipboard-list"></i>
					Mes ardoises</span>
				<span class="label-muted">Lien public uniquement si "Publie" est actif.</span>
			</div>
			<div class="card-body">
				{% if menus is defined and menus|length > 0 %}
					<div class="table-responsive">
						<table class="table-modern align-middle">
							<thead>
								<tr>
									<th>Type</th>
									<th>Titre</th>
									{% if is_granted('ROLE_SUPER_ADMIN') %}
										<th>Restaurant</th>
									{% endif %}
									<th>Statut</th>
									<th>Lien</th>
								</tr>
							</thead>
							<tbody>
								{% for menu in menus %}
									{% set rowUrl = url('app_show_menu', {
                                        restaurant: menu.owner.slug,
                                        slug: menu.slug
                                    }) %}
									<tr>
										<td>
											{% if menu.type == 'DAILY' %}
												<span class="pill daily">
													<i class="fa fa-sun"></i>
													Jour
												</span>
											{% else %}
												<span class="pill special">
													<i class="fa fa-star"></i>
													Special
												</span>
											{% endif %}
										</td>
										<td>
											<strong>{{ menu.titre }}</strong>
										</td>
										{% if is_granted('ROLE_SUPER_ADMIN') %}
											<td>
												<small class="text-muted">{{ menu.owner.nomRestaurant }}</small>
											</td>
										{% endif %}
										<td>
											{% if menu.status %}
												<span class="pill success">
													<i class="fa fa-check"></i>
													Publie
												</span>
											{% else %}
												<span class="pill draft">
													<i class="fa fa-moon"></i>
													Brouillon
												</span>
											{% endif %}
										</td>
										<td>
											<div class="input-group input-group-sm">
												<input type="text" class="form-control" value="{{ rowUrl }}" id="url-{{ menu.id }}" readonly>
												<button class="btn btn-outline-primary" type="button" onclick="copyToClipboard('url-{{ menu.id }}')" title="Copier le lien" {% if not menu.status %} disabled {% endif %}>
													<i class="fa fa-copy"></i>
												</button>
												<a href="{{ rowUrl }}" class="btn {{ menu.status ? 'btn-outline-success' : 'btn-outline-secondary disabled' }}" target="_blank" title="Voir le menu" {% if not menu.status %} aria-disabled="true" tabindex="-1" {% endif %}>
													<i class="fa fa-external-link-alt"></i>
												</a>
											</div>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% else %}
					<p class="mb-0 text-muted">Aucun menu pour le moment. Lancez un menu du jour ou un special pour commencer.</p>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
